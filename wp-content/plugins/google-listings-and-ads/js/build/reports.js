"use strict";(self.webpackChunkgoogle_listings_and_ads=self.webpackChunkgoogle_listings_and_ads||[]).push([[992],{3183:function(e,t,a){a.r(t),a.d(t,{default:function(){return Ye}});var r=a(9307),s=a(5736),n=a(431),l=a(9818),o=a(6166),i=a(7796);function c(){return[...new Set((arguments.length>0&&void 0!==arguments[0]?arguments[0]:"").split(",").map((e=>parseInt(e,10))).filter((e=>!isNaN(e))))]}function d(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return e.reduce(((e,r)=>(e[r]=(t[r]||0)+(a[r]||0),e)),{})}function u(e,t){if(!t)return e||null;if(!e)return t;const a=new Map(e.map((e=>[e.interval,e.subtotals]))),r=new Map(t.map((e=>[e.interval,e.subtotals])));return[...new Set([...a.keys(),...r.keys()])].sort().map((e=>({interval:e,subtotals:d(i.jz,a.get(e),r.get(e))})))}function g(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2?arguments[2]:void 0;const r=e?Object.keys(e):a;return e=e||{},r.reduce(((r,s)=>{let n=i.Km.NONE,l=e[s];return a&&(a.includes(s)?void 0===t[s]?n=i.Km.FOR_REQUEST:l=(e[s]||0)+t[s]:n=i.Km.FOR_METRIC),{...r,[s]:(0,i.m3)(l,void 0,n)}}),{})}var p=a(5125),m=a(3108);const h="programs",y={free_listings:[],campaigns:[],intervals:[],totals:{}},f={loaded:!0,data:{},reportQuery:null};function _(e,t,a){const r=c(t[m.QI]),s=0===r.length||r.includes(m.Pv),n=(0===r.length||r.some((e=>e!==m.Pv)))&&m.glaData.adsSetupComplete;return{free:s&&e(h,"free",t,a)||f,paid:n&&e(h,"paid",t,a)||f}}var b=a(4485),v=a(3745);const k=(0,s.__)("Unavailable","google-listings-and-ads");function S(e){const{formatNumber:t}=(0,b.Z)(),{formatAmount:a}=(0,v.Z)();return(0,r.useMemo)((()=>{function r(e){return void 0===e?k:this.isCurrency?a(e,!0):t(e,0)}return e.map((e=>({...e,formatFn:r})))}),[e,t,a])}var E=a(3153),C=a(6439),F=a(2819),w=a(1921),P=a(4617);const T=[{id:m.Pv,name:(0,s.__)("Free Listings","google-listings-and-ads")}],L=new Set(T.map((e=>e.id)));var q=a(4126),Q=a(7462),N=a(5697),M=a.n(N),D=a(7844),R=a.n(D),Z=a(6020),I=a(5609),x=a(4486);class B extends r.Component{constructor(e){let{getLabels:t,param:a,query:r}=e;super(...arguments),this.state={selected:[]},this.clearQuery=this.clearQuery.bind(this),this.updateQuery=this.updateQuery.bind(this),this.updateLabels=this.updateLabels.bind(this),this.onButtonClicked=this.onButtonClicked.bind(this),r[a]&&t(r[a],r).then(this.updateLabels)}componentDidUpdate(e,t){let{param:a,query:r}=e,{selected:s}=t;const{getLabels:l,param:o,query:i}=this.props,{selected:c}=this.state;if(a!==o||s.length>0&&0===c.length)return void this.clearQuery();const d=(0,n.getIdsFromQuery)(r[o]),u=(0,n.getIdsFromQuery)(i[o]);(0,F.isEqual)(d.sort(),u.sort())||l(i[o],i).then(this.updateLabels)}clearQuery(){const{param:e,path:t,query:a}=this.props;this.setState({selected:[]}),(0,n.updateQueryString)({[e]:void 0},t,a)}updateLabels(e){this.setState({selected:e})}updateQuery(){const{param:e,path:t,query:a}=this.props,{selected:r}=this.state,s=r.map((e=>e.key));(0,n.updateQueryString)({[e]:s.join(",")},t,a)}onButtonClicked(e){this.updateQuery(e),(0,F.isFunction)(this.props.onClick)&&this.props.onClick(e)}render(){const{labels:e,type:t,autocompleter:a}=this.props,{selected:n}=this.state;return(0,r.createElement)(I.Card,{className:"woocommerce-filters__compare"},(0,r.createElement)(I.CardHeader,null,(0,r.createElement)(x.Z,{variant:"subtitle-small"},e.title)),(0,r.createElement)(I.CardBody,null,(0,r.createElement)(Z.Search,{autocompleter:a,type:t,selected:n,placeholder:e.placeholder,onChange:e=>{this.setState({selected:e})}})),(0,r.createElement)(I.CardFooter,{justify:"flex-start"},(0,r.createElement)(Z.CompareButton,{count:n.length,helpText:e.helpText,onClick:this.onButtonClicked},e.update),n.length>0&&(0,r.createElement)(I.Button,{isLink:!0,onClick:this.clearQuery},(0,s.__)("Clear all","woocommerce-admin"))))}}B.propTypes={getLabels:M().func.isRequired,labels:M().shape({placeholder:M().string,title:M().string,update:M().string}),param:M().string.isRequired,path:M().string.isRequired,query:M().object,type:M().string.isRequired,autocompleter:M().object},B.defaultProps={labels:{},query:{}};var A=a(5904),O=a(4184),V=a.n(O),j=a(1984),K=a(4310);const U="all";class z extends r.Component{constructor(e){super(e);const t=this.getFilter();if(this.state={nav:t.path||[],animate:null,selectedTag:null},this.selectSubFilter=this.selectSubFilter.bind(this),this.getVisibleFilters=this.getVisibleFilters.bind(this),this.updateSelectedTag=this.updateSelectedTag.bind(this),this.onTagChange=this.onTagChange.bind(this),this.onContentMount=this.onContentMount.bind(this),this.goBack=this.goBack.bind(this),t.settings&&t.settings.getLabels){const{query:e}=this.props,{param:a,getLabels:r}=t.settings;r(e[a],e).then(this.updateSelectedTag)}}componentDidUpdate(e){let{query:t}=e;const{query:a,config:r}=this.props;if(t[r.param]!==a[[r.param]]){const e=this.getFilter();if(e&&"Search"===e.component){this.setState({nav:e.path||[]});const{param:t,getLabels:r}=e.settings;r(a[t],a).then(this.updateSelectedTag)}}}updateSelectedTag(e){this.setState({selectedTag:e[0]})}getFilter(e){const{config:t,query:a}=this.props,r=(0,n.flattenFilters)(t.filters);return e=e||a[t.param]||t.defaultValue||U,(0,F.find)(r,{value:e})||{}}getButtonLabel(e){if("Search"===e.component){const{selectedTag:t}=this.state;return[t&&t.label,(0,F.get)(e,"settings.labels.button")]}return e?[e.label]:[]}getVisibleFilters(e,t){if(0===t.length)return e;const a=t[0],r=(0,F.find)(e,{value:a});return this.getVisibleFilters(r&&r.subFilters,t.slice(1))}selectSubFilter(e){this.setState((t=>({nav:[...t.nav,e],animate:"left"})))}goBack(){this.setState((e=>({nav:e.nav.slice(0,-1),animate:"right"})))}update(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{path:a,query:r,config:s,onFilterSelect:l}=this.props,o=(0,n.getPersistedQuery)(r),i={[s.param]:(s.defaultValue||U)===e?void 0:e,...t};s.staticParams.forEach((e=>{i[e]=r[e]})),(0,n.updateQueryString)(i,a,o),l(i)}onTagChange(e,t,a,r){const s=(0,F.last)(r),{value:n,settings:l}=e,{param:o}=l;s?(this.update(n,{[o]:s.key}),t()):this.update(a.defaultValue||U),this.updateSelectedTag([s])}renderButton(e,t,a){if(e.component){const{type:s,labels:n,autocompleter:l}=e.settings,o=this.getFilter().value===e.value?this.state.selectedTag:null;return(0,r.createElement)(Z.Search,{autocompleter:l,className:"woocommerce-filters-filter__search",type:s,placeholder:n.placeholder,selected:o?[o]:[],onChange:(0,F.partial)(this.onTagChange,e,t,a),inlineTags:!0,staticResults:!0})}const s=a=>{t(a),this.update(e.value,e.query||{}),this.setState({selectedTag:null})},n=(0,F.partial)(this.selectSubFilter,e.value),l=this.getFilter(),o=l.value===e.value||l.path&&(0,F.includes)(l.path,e.value);return(0,r.createElement)(I.Button,{className:"woocommerce-filters-filter__button",onClick:a=>{o?t(a):e.subFilters?n(a):s(a)}},e.label)}onContentMount(e){const{nav:t}=this.state,a=t.length&&this.getFilter(t[t.length-1])?1:0,r=A.focus.tabbable.find(e)[a];setTimeout((()=>{r.focus()}),0)}render(){const{config:e}=this.props,{nav:t,animate:a}=this.state,n=this.getVisibleFilters(e.filters,t),l=!!t.length&&this.getFilter(t[t.length-1]),o=this.getFilter();return(0,r.createElement)("div",{className:"woocommerce-filters-filter"},e.label&&(0,r.createElement)("span",{className:"woocommerce-filters-label"},e.label,":"),(0,r.createElement)(I.Dropdown,{contentClassName:"woocommerce-filters-filter__content",position:"bottom",expandOnMobile:!0,headerTitle:(0,s.__)("filter report to show:","woocommerce-admin"),renderToggle:e=>{let{isOpen:t,onToggle:a}=e;return(0,r.createElement)(Z.DropdownButton,{onClick:a,isOpen:t,labels:this.getButtonLabel(o)})},renderContent:s=>{let{onClose:i}=s;return(0,r.createElement)(Z.AnimationSlider,{animationKey:t,animate:a,onExited:this.onContentMount},(()=>(0,r.createElement)("ul",{className:"woocommerce-filters-filter__content-list"},l&&(0,r.createElement)("li",{className:"woocommerce-filters-filter__content-list-item"},(0,r.createElement)(I.Button,{className:"woocommerce-filters-filter__button",onClick:this.goBack},(0,r.createElement)(j.Z,{icon:K.Z}),l.label)),n.map((t=>(0,r.createElement)("li",{key:t.value,className:V()("woocommerce-filters-filter__content-list-item",{"is-selected":o.value===t.value||o.path&&(0,F.includes)(o.path,t.value)})},this.renderButton(t,i,e)))))))}}))}}z.propTypes={config:M().shape({label:M().string,staticParams:M().array.isRequired,param:M().string.isRequired,defaultValue:M().string,showFilters:M().func.isRequired,filters:M().arrayOf(M().shape({chartMode:M().oneOf(["item-comparison","time-comparison"]),component:M().string,label:M().string,path:M().string,subFilters:M().array,value:M().string.isRequired}))}).isRequired,path:M().string.isRequired,query:M().object,onFilterSelect:M().func},z.defaultProps={query:{},onFilterSelect:()=>{}};var G=z;class H extends r.Component{constructor(){super(),this.renderCard=this.renderCard.bind(this),this.onRangeSelect=this.onRangeSelect.bind(this)}renderCard(e){const{siteLocale:t,advancedFilters:a,query:s,path:n,onAdvancedFilterAction:l,currency:o}=this.props,{filters:i,param:c}=e;if(!s[c])return null;if(0===s[c].indexOf("compare")){const e=(0,F.find)(i,{value:s[c]});if(!e)return null;const{settings:t={}}=e;return(0,r.createElement)("div",{key:c,className:"woocommerce-filters__advanced-filters"},(0,r.createElement)(B,(0,Q.Z)({path:n,query:s},t)))}return"advanced"===s[c]?(0,r.createElement)("div",{key:c,className:"woocommerce-filters__advanced-filters"},(0,r.createElement)(Z.AdvancedFilters,{siteLocale:t,currency:o,config:a,path:n,query:s,onAdvancedFilterAction:l})):void 0}onRangeSelect(e){const{query:t,path:a,onDateSelect:r}=this.props;(0,n.updateQueryString)(e,a,t),r(e)}getDateQuery(e){const{period:t,compare:a,before:r,after:s}=(0,w.getDateParamsFromQuery)(e),{primary:n,secondary:l}=(0,w.getCurrentDates)(e);return{period:t,compare:a,before:r,after:s,primaryDate:n,secondaryDate:l}}render(){const{dateQuery:e,filters:t,query:a,path:n,showDatePicker:l,onFilterSelect:o,isoDateFormat:i}=this.props;return(0,r.createElement)(r.Fragment,null,(0,r.createElement)(Z.H,{className:"screen-reader-text"},(0,s.__)("Filters","woocommerce-admin")),(0,r.createElement)(Z.Section,{component:"div",className:"woocommerce-filters"},(0,r.createElement)("div",{className:"woocommerce-filters__basic-filters"},l&&(0,r.createElement)(Z.DateRangeFilterPicker,{key:JSON.stringify(a),dateQuery:e||this.getDateQuery(a),onRangeSelect:this.onRangeSelect,isoDateFormat:i}),t.map((e=>e.showFilters(a)?(0,r.createElement)(G,{key:e.param,config:e,query:a,path:n,onFilterSelect:o}):null))),t.map(this.renderCard)))}}H.propTypes={siteLocale:M().string,advancedFilters:M().object,filters:M().array,path:M().string.isRequired,query:M().object,showDatePicker:M().bool,onDateSelect:M().func,onFilterSelect:M().func,onAdvancedFilterAction:M().func,currency:M().object,dateQuery:M().shape({period:M().string.isRequired,compare:M().string.isRequired,before:M().object,after:M().object,primaryDate:M().shape({label:M().string.isRequired,range:M().string.isRequired}).isRequired,secondaryDate:M().shape({label:M().string.isRequired,range:M().string.isRequired})}),isoDateFormat:M().string},H.defaultProps={siteLocale:"en_US",advancedFilters:{},filters:[],query:{},showDatePicker:!0,onDateSelect:()=>{},currency:R()().getCurrencyConfig()};var Y=H,J=a(1410);const $=(0,P.getSetting)("locale").siteLocale,W=(()=>{let e,t,a;function r(){e=null,a=new Promise((e=>{t=e})).then((()=>T.concat(e)))}r();const n={name:"programs",options:()=>a,getOptionIdentifier:e=>e.id,getOptionLabel:e=>e.name,getOptionKeywords:e=>[e.name],getOptionCompletion:e=>({key:e.id,label:e.name})};async function l(e){const t=new Set(c(e));let r;return r=function(e,t){if(e.size>t.size)return!1;for(const a of e)if(!t.has(a))return!1;return!0}(t,L)?T:(await a).filter((e=>t.has(e.id))),r.map((e=>({key:e.id,label:e.name})))}const o={label:(0,s.__)("Show","google-listings-and-ads"),staticParams:["period","chartType","paged","per_page","selectedMetric","reportKey","orderby","order"],param:"filter",showFilters:()=>!0,filters:[{label:(0,s.__)("All Google programs","google-listings-and-ads"),value:"all"},{label:(0,s.__)("Single program","google-listings-and-ads"),value:"select_program",subFilters:[{component:"Search",value:"single_program",path:["select_program"],settings:{type:"custom",param:m.QI,getLabels:l,labels:{placeholder:(0,s.__)("Type to search for a program","google-listings-and-ads"),button:(0,s.__)("Single Program","google-listings-and-ads")},autocompleter:n}}]},{label:(0,s.__)("Comparison","google-listings-and-ads"),chartMode:"item-comparison",value:"compare-programs",settings:{type:"custom",param:m.QI,getLabels:l,labels:{helpText:(0,s.__)("Check at least two programs below to compare","google-listings-and-ads"),placeholder:(0,s.__)("Search for programs to compare","google-listings-and-ads"),title:(0,s.__)("Compare Programs","google-listings-and-ads"),update:(0,s.__)("Compare","google-listings-and-ads")},autocompleter:n}}]};return a=>{let{data:s,loaded:n}=a;return n?(e&&e!==s&&r(),e=s,t()):e&&r(),o}})();var X=e=>{const{query:t,trackEventId:a}=e,s=[W((0,q.Z)({exclude_removed:!1}))],{period:n,compare:l,before:o,after:i}=(0,w.getDateParamsFromQuery)(t),{primary:c,secondary:d}=(0,w.getCurrentDates)(t),u={period:n,compare:l,before:o,after:i,primaryDate:c,secondaryDate:d},g=(0,b.Z)(),p={...t};return(0,r.createElement)(Y,{query:p,siteLocale:$,currency:g,filters:s,onDateSelect:e=>(0,J.dk)("gla_datepicker_update",{report:a,...(0,F.omitBy)(e,F.isUndefined)}),onFilterSelect:e=>(0,J.dk)("gla_filter",{report:a,filter:e.filter||"all"}),path:t.path,dateQuery:u,isoDateFormat:w.isoDateFormat})},ee=a(7132),te=a(4863),ae=a(3201);const re="https://merchants.google.com/mc/reporting/dashboard";var se=e=>{let{href:t,selected:a,onLinkClickCallback:n,metric:l,data:{value:o,prevValue:c,delta:d,missingFreeListingsData:u}}=e;const g=(0,r.useMemo)((()=>({value:l.formatFn(o),prevValue:l.formatFn(c)})),[l,o,c]);let p=l.label;const m=[],h=[];if(u!==i.Km.NONE){const e=(0,s.__)("This data is currently available for paid campaigns only.","google-listings-and-ads");m.push(e),h.push(e)}if(u===i.Km.FOR_REQUEST){const e=(0,s.__)("Please try again later, or go to <googleMerchantCenterLink /> to track your performance for Google Free Listings.","google-listings-and-ads");m.push((0,r.createInterpolateElement)(e,{googleMerchantCenterLink:(0,r.createElement)(ae.Z,{eventName:"gla_google_mc_link_click",eventProps:{context:"reports",href:re},type:"external",target:"_blank",href:re,onClick:e=>e.stopPropagation()},(0,s.__)("Google Merchant Center","google-listings-and-ads"))}));const t=(0,r.createInterpolateElement)(e,{googleMerchantCenterLink:(0,r.createElement)(r.Fragment,null,(0,s.sprintf)(
// translators: %s: link to Google Merchant Center.
(0,s.__)("Google Merchant Center (%s)","google-listings-and-ads"),re))});h.push((0,r.renderToString)(t))}if(m.length>0){const e=m.map(((e,t)=>(0,r.createElement)("div",{className:"gla-reports__metric-info",key:t},e)));p=(0,r.createElement)("div",{className:"gla-reports__metric-label"},l.label,(0,r.createElement)(te.Z,{text:e},(0,r.createElement)(ee.Z,{className:"gla-reports__metric-infoicon",role:"img","aria-label":h.join(" "),size:16})))}return(0,r.createElement)(Z.SummaryNumber,(0,Q.Z)({label:p,href:t,selected:a,delta:d,onLinkClickCallback:n},g))};const ne={value:null,preValue:null,delta:null};var le=e=>{let{loaded:t,metrics:a,expectedLength:s=a.length,totals:l,trackEventId:o}=e;const i=(0,p.Z)();if(!t)return(0,r.createElement)(Z.SummaryListPlaceholder,{numberOfItems:s});const{selectedMetric:c=a[0].key}=i;return(0,r.createElement)(Z.SummaryList,null,(()=>a.map((e=>{const{key:t}=e,a=c===t,s=(0,n.getNewPath)({selectedMetric:t});return(0,r.createElement)(se,{key:t,metric:e,href:s,selected:a,data:l[t]||ne,onLinkClickCallback:()=>{return e=t,void(0,J.dk)("gla_chart_tab_click",{report:o,context:e});var e}})}))))};const oe=(0,s.__)("No data for the selected date range","google-listings-and-ads");function ie(e){let{metrics:t,loaded:a,intervals:s}=e;const n=(0,p.Z)(),l=(0,b.Z)(),{selectedMetric:o}=n;let i={};t.length&&(i=o&&t.find((e=>e.key===o))||t[0]);const{key:c,label:d,isCurrency:u=!1,formatFn:g}=i,m={...l,symbol:""},h=(0,w.getChartTypeForQuery)(n),y=u?"currency":"number",f=g.bind(i),_=(0,r.useMemo)((()=>a?s.map((e=>{let{interval:t,subtotals:a}=e;return{date:t,[d]:{value:a[c],label:d}}})):[]),[c,d,a,s]);return(0,r.createElement)(Z.Chart,{data:_,title:d,query:n,currency:m,chartType:h,valueType:y,tooltipValueFormat:f,isRequesting:!a,emptyMessage:oe,layout:"time-comparison",legendPosition:"hidden"})}var ce=a(965),de=a(6308),ue=e=>{let{compareBy:t,compareParam:a,metrics:l,isLoading:o,compareButonTitle:i,data:d,nameHeader:u,nameCell:g,...m}=e;const h=(0,p.Z)(),[y,f]=(0,r.useState)((()=>new Set(c(h[t])))),_=d.length||5,b=(0,r.useMemo)((()=>{if(!l.length)return[];const e=l.map((e=>({...e,isSortable:!0,isNumeric:!0})));return e[0].defaultSort=!0,e[0].defaultOrder="desc",e}),[l]),v=e=>l.map((t=>{const a=e.subtotals[t.key];return{display:t.formatFn(a)}})),k=(e,t)=>{t?f(new Set([...y,e])):(y.delete(e),f(new Set(y)))};return(0,r.createElement)(de.Z,(0,Q.Z)({actions:(0,r.createElement)(ce.Z,{isSecondary:!0,disabled:o||y.size<=1,title:i,onClick:()=>{const e=Array.from(y).join(",");(0,n.onQueryChange)("compare")(t,a,e)}},(0,s.__)("Compare","google-listings-and-ads")),isLoading:o,headers:(S=d,[{key:"compare",label:(0,r.createElement)(I.CheckboxControl,{disabled:o,checked:!o&&S.length&&y.size===S.length,onChange:e=>{if(e){const e=d.map((e=>e.id));f(new Set(e))}else f(new Set)}}),required:!0},{key:"title",label:u,isLeftAligned:!0,required:!0},...b]),rows:(e=>e.map((e=>[{display:(0,r.createElement)(I.CheckboxControl,{checked:y.has(e.id),onChange:k.bind(null,e.id)})},{display:g(e)},...v(e)])))(d),totalRows:d.length,rowsPerPage:_,query:h,compareBy:t,compareParam:a,onQueryChange:n.onQueryChange,onSort:(0,n.onQueryChange)("sort")},m));var S},ge=e=>{let{isConverted:t,name:a}=e;return t?(0,r.createElement)("div",{className:"gla-reports__tooltip-campaign-name"},(0,r.createElement)(te.Z,{position:"top right",text:(0,s.__)("This campaign has been upgraded to Performance Max","google-listings-and-ads")},a)):a},pe=e=>{let{isLoading:t,orderby:a,order:n,metrics:l,freeListings:o,campaigns:i,...c}=e;const d=(0,r.useMemo)((()=>{if(t)return[];if(!o||0===o.length)return i;const e=[{...o[0],name:(0,s.__)("Free Listings","google-listings-and-ads"),id:m.Pv},...i];return i.length&&(e.sort(((e,t)=>(e.subtotals[a]||Number.NEGATIVE_INFINITY)-(t.subtotals[a]||Number.NEGATIVE_INFINITY))),"desc"===n&&e.reverse()),e}),[t,o,i,a,n]);return(0,r.createElement)(ue,(0,Q.Z)({title:(0,s.__)("Programs","google-listings-and-ads"),compareButonTitle:(0,s.__)("Select one or more programs to compare","google-listings-and-ads"),nameHeader:(0,s.__)("Program","google-listings-and-ads"),nameCell:ge,compareBy:"programs",compareParam:"filter",metrics:l,isLoading:t,data:d},c))},me=a(4492),he=a(7018),ye=a(5621),fe=a(1333);const _e=[{key:"programs",title:(0,s.__)("Programs","google-listings-and-ads"),href:(0,n.getNewPath)({reportKey:"programs"},"/google/reports",{})},{key:"products",title:(0,s.__)("Products","google-listings-and-ads"),href:(0,n.getNewPath)({reportKey:"products"},"/google/reports",{})}];var be=()=>{const e=(0,he.Z)(),t=(0,fe.Z)();return e?(0,r.createElement)(me.Z,{tabs:_e,selectedKey:t}):(0,r.createElement)(ye.Z,{tabs:_e,selectedKey:t})};const ve=[{key:"sales",label:(0,s.__)("Total Sales","google-listings-and-ads"),isCurrency:!0},{key:"conversions",label:(0,s.__)("Conversions","google-listings-and-ads")},{key:"clicks",label:(0,s.__)("Clicks","google-listings-and-ads")},{key:"impressions",label:(0,s.__)("Impressions","google-listings-and-ads")}],ke=[...ve,{key:"spend",label:(0,s.__)("Total Spend","google-listings-and-ads"),isCurrency:!0}],Se=[...ve,{key:"spend",label:(0,s.__)("Spend","google-listings-and-ads"),isCurrency:!0}];var Ee=()=>{const e="reports-programs",{loaded:t,data:{totals:a,intervals:s,freeListings:c,campaigns:d},reportQuery:{fields:m,orderby:h,order:f}}=function(){const e=(0,p.Z)(),{paid:t,free:a}=(0,l.useSelect)((t=>{const{getReport:a}=t(o.Ls);return _(a,e,"primary")}),[e]),s=t.loaded&&a.loaded,n=t.reportQuery||a.reportQuery,i=a.reportQuery?.fields,c=(0,r.useMemo)((()=>{const e=a.data,r=t.data;return s&&r&&e?{freeListings:e.free_listings||y.free_listings,campaigns:r.campaigns||y.campaigns,intervals:u(r.intervals,e.intervals)||y.intervals,totals:g(r.totals,e.totals,i)}:y}),[s,t.data,a.data,i]);return{loaded:s,reportQuery:n,data:c}}(),b=(0,r.useMemo)((()=>{const e=t&&Object.keys(a).length>0;return{available:e?ke.filter((e=>{let{key:t}=e;return a.hasOwnProperty(t)})):ke.filter((e=>{let{key:t}=e;return m.includes(t)})),expected:e?Se.filter((e=>{let{key:t}=e;return a.hasOwnProperty(t)})):Se.filter((e=>{let{key:t}=e;return m.includes(t)}))}}),[t,a,m]),v=S(b.available),k=S(b.expected),{loaded:F,data:w}=function(e){const t=(0,p.Z)(),{loaded:a,data:s}=function(e){const{paid:t,free:a}=(0,l.useSelect)((t=>{const{getReport:a}=t(o.Ls);return _(a,e,"secondary")}),[e]),s=t.loaded&&a.loaded,n=a.reportQuery?.fields,i=(0,r.useMemo)((()=>{const e=a.data,r=t.data;return s&&r&&e?g(r.totals,e.totals,n):y.totals}),[s,t.data,a.data,n]);return{loaded:s,data:i}}(t),n=(0,r.useMemo)((()=>a?function(e,t){return Object.keys(e).reduce(((a,r)=>({...a,[r]:(0,i.m3)(e[r].value,t[r]?.value,e[r].missingFreeListingsData)})),{})}(e,s):e),[a,s,e]);return{loaded:a,data:n}}(a),P=F?w:a;return(0,r.createElement)(r.Fragment,null,(0,r.createElement)(E.Z,{context:e}),(0,r.createElement)(C.Z,null),(0,r.createElement)(be,null),(0,r.createElement)(X,{query:(0,n.getQuery)(),trackEventId:e}),(0,r.createElement)(le,{loaded:t,metrics:v,expectedLength:ke.length,totals:P,trackEventId:e}),(0,r.createElement)(ie,{metrics:v,loaded:t,intervals:s}),(0,r.createElement)(pe,{trackEventReportId:e,isLoading:!t,orderby:h,order:f,metrics:k,freeListings:c,campaigns:d}))};const Ce="products",Fe={products:[],intervals:[],totals:{}};var we=a(279),Pe=a(7221),Te=a(2694),Le=a(6483),qe=a(6989),Qe=a.n(qe);function Ne(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:F.identity;return function(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const r="function"==typeof e?e(arguments.length>1?arguments[1]:void 0):e,s=(0,n.getIdsFromQuery)(a);if(s.length<1)return Promise.resolve([]);const l={include:s.join(","),per_page:s.length};return Qe()({path:(0,Le.addQueryArgs)(r,l)}).then((e=>e.map(t)))}}const Me=Ne(Pe.NAMESPACE+"/products",(e=>({key:e.id,label:e.name,type:e.type})));function De(e){let{attributes:t,name:a}=e;const r=(0,P.getSetting)("admin")?.variationTitleAttributesSeparator||" - ";if(a.indexOf(r)>-1)return a;const s=t.map((e=>{let{option:t}=e;return t})).join(", ");return s?a+r+s:a}const Re=Ne((e=>{let{products:t}=e;return t?Pe.NAMESPACE+`/products/${t}/variations`:Pe.NAMESPACE+"/variations"}),(e=>({key:e.id,label:De(e)}))),Ze={label:(0,s.__)("Show","google-listings-and-ads"),staticParams:[m.CT,"chartType","orderby","order","paged","per_page","selectedMetric","reportKey"],param:"filter",showFilters:()=>!0,filters:[{label:(0,s.__)("All Products","google-listings-and-ads"),value:"all"},{label:(0,s.__)("Single Product","google-listings-and-ads"),value:"select_product",chartMode:"item-comparison",subFilters:[{component:"Search",value:"single-product",chartMode:"item-comparison",path:["select_product"],settings:{type:"products",param:"products",getLabels:Me,labels:{placeholder:(0,s.__)("Type to search for a product","google-listings-and-ads"),button:(0,s.__)("Single Product","google-listings-and-ads")}}}]},{label:(0,s.__)("Comparison","google-listings-and-ads"),value:"compare-products",chartMode:"item-comparison",settings:{type:"products",param:"products",getLabels:Me,labels:{helpText:(0,s.__)("Check at least two products below to compare","google-listings-and-ads"),placeholder:(0,s.__)("Search for products to compare","google-listings-and-ads"),title:(0,s.__)("Compare Products","google-listings-and-ads"),update:(0,s.__)("Compare","google-listings-and-ads")}}}]},Ie={showFilters:e=>"single-product"===e.filter&&!!e.products&&e["is-variable"],staticParams:["filter","products","chartType","orderby","order","paged","per_page","selectedMetric","reportKey"],param:"filter-variations",filters:[{label:(0,s.__)("All Variations","google-listings-and-ads"),chartMode:"item-comparison",value:"all"},{label:(0,s.__)("Single Variation","google-listings-and-ads"),value:"select_variation",subFilters:[{component:"Search",value:"single-variation",path:["select_variation"],settings:{type:"variations",param:"variations",getLabels:Re,labels:{placeholder:(0,s.__)("Type to search for a variation","google-listings-and-ads"),button:(0,s.__)("Single Variation","google-listings-and-ads")}}}]},{label:(0,s.__)("Comparison","google-listings-and-ads"),chartMode:"item-comparison",value:"compare-variations",settings:{type:"variations",param:"variations",getLabels:Re,labels:{helpText:(0,s.__)("Check at least two variations below to compare","google-listings-and-ads"),placeholder:(0,s.__)("Search for variations to compare","google-listings-and-ads"),title:(0,s.__)("Compare Variations","google-listings-and-ads"),update:(0,s.__)("Compare","google-listings-and-ads")}}}]},xe={label:(0,s.__)("Show data from","google-listings-and-ads"),param:m.CT,staticParams:["filter","products","orderby","order","chartType","selectedMetric","reportKey"],defaultValue:m.U2,filters:[{value:m.fD,label:(0,s.__)("Paid campaigns","google-listings-and-ads")},{value:m.eT,label:(0,s.__)("Free listings","google-listings-and-ads")}],showFilters:e=>{let{hasPaidSource:t}=e;return t}},Be=(0,Te.applyFilters)("gla_products_report_filters",[Ze,Ie,xe]),Ae=(0,Te.applyFilters)("gla_products_report_advanced_filters",{}),Oe=(0,P.getSetting)("currency"),Ve=(0,P.getSetting)("locale").siteLocale;var je=e=>{const{hasPaidSource:t,query:a,trackEventId:s}=e,{period:n,compare:o,before:i,after:c}=(0,w.getDateParamsFromQuery)(a),{primary:d,secondary:u}=(0,w.getCurrentDates)(a),g={period:n,compare:o,before:i,after:c,primaryDate:d,secondaryDate:u},p=(0,l.useSelect)((e=>{if(a.search||!a.products||1!==a.products.split(",").length)return!1;const t=parseInt(a.products,10),r={include:t},{getItems:s}=e(Pe.ITEMS_STORE_NAME),n=s("products",r);return n&&n.get(t)&&"variable"===n.get(t).type}),[a.search,a.products]),m={...a,"is-variable":p,hasPaidSource:t};return(0,r.createElement)(Z.ReportFilters,{query:m,siteLocale:Ve,currency:Oe,filters:Be,advancedFilters:Ae,onDateSelect:e=>(0,J.dk)("gla_datepicker_update",{report:s,...(0,F.omitBy)(e,F.isUndefined)}),onFilterSelect:e=>(0,J.dk)("gla_filter",{report:s,filter:e.filter||"all",filterVariations:e["filter-variations"]}),dateQuery:g,isoDateFormat:w.isoDateFormat})},Ke=e=>{let{metrics:t,isLoading:a,products:n,...l}=e;return(0,r.createElement)(ue,(0,Q.Z)({title:(0,s.__)("Products","google-listings-and-ads"),compareButonTitle:(0,s.__)("Select one or more products to compare","google-listings-and-ads"),nameHeader:(0,s.__)("Product title","google-listings-and-ads"),nameCell:e=>e.name,compareBy:"products",compareParam:"filter",metrics:t,isLoading:a,data:n},l))};const Ue=[{key:"clicks",label:(0,s.__)("Clicks","google-listings-and-ads")},{key:"impressions",label:(0,s.__)("Impressions","google-listings-and-ads")}],ze=[{key:"sales",label:(0,s.__)("Total Sales","google-listings-and-ads"),isCurrency:!0},{key:"conversions",label:(0,s.__)("Conversions","google-listings-and-ads")},...Ue,{key:"spend",label:(0,s.__)("Spend","google-listings-and-ads"),isCurrency:!0}],Ge=e=>{let{hasPaidSource:t}=e;const a="reports-products",s=(0,n.getQuery)(),c=t?s[m.CT]||m.U2:m.eT,d=S(c===m.fD?ze:Ue),{loaded:u,data:{totals:g,intervals:h,products:y}}=function(e){const t=(0,p.Z)();return(0,l.useSelect)((a=>{const{getReport:r}=a(o.Ls),s=r(Ce,e,t,"primary"),n=r(Ce,e,t,"secondary"),l=s.loaded&&n.loaded;let c=Fe;return l&&s.data&&n.data&&(c={products:s.data.products||Fe.products,intervals:s.data.intervals||Fe.intervals,totals:(0,i.g0)(s.data.totals,n.data.totals,s.reportQuery.fields)}),{data:c,loaded:l}}),[e,t])}(c);return(0,r.createElement)(r.Fragment,null,(0,r.createElement)(je,{hasPaidSource:t,query:s,trackEventId:a}),(0,r.createElement)(le,{metrics:d,loaded:u,totals:g,trackEventId:a}),(0,r.createElement)(ie,{metrics:d,loaded:u,intervals:h}),(0,r.createElement)(Ke,{trackEventReportId:a,metrics:d,isLoading:!u,products:y}))};var He=()=>{const{loaded:e,data:t}=(0,q.Z)(),a=e&&t.some((e=>{let{status:t}=e;return"enabled"===t}));return(0,r.createElement)(r.Fragment,null,(0,r.createElement)(E.Z,{context:"reports-products"}),(0,r.createElement)(C.Z,null),(0,r.createElement)(be,null),e?(0,r.createElement)(Ge,{hasPaidSource:a}):(0,r.createElement)(we.Z,null))},Ye=()=>"products"===(0,fe.Z)()?(0,r.createElement)(He,null):(0,r.createElement)(Ee,null)}}]);